---
/**
 * MethodCard Component
 *
 * Displays HTTP/WebDAV method information in a card format.
 * Shows method name, description, request/response details, and examples.
 *
 * @example
 * <MethodCard
 *   method="PROPFIND"
 *   httpMethod="POST"
 *   standard="WebDAV"
 *   rfc="4918"
 * >
 *   <Fragment slot="description">
 *     Retrieves properties defined on a resource or collection.
 *   </Fragment>
 *   <Fragment slot="request">
 *     XML body with property names to retrieve
 *   </Fragment>
 *   <Fragment slot="response">
 *     207 Multi-Status with requested properties
 *   </Fragment>
 * </MethodCard>
 */

interface Props {
  method: string;
  httpMethod?: 'GET' | 'POST' | 'PUT' | 'DELETE' | 'PATCH' | 'OPTIONS' | 'HEAD';
  standard?: 'HTTP' | 'WebDAV' | 'CalDAV' | 'CardDAV';
  rfc?: string;
  variant?: 'default' | 'read' | 'write' | 'special';
  implemented?: boolean;
  since?: string;
}

const {
  method,
  httpMethod,
  standard = 'WebDAV',
  rfc,
  variant = 'default',
  implemented = true,
  since,
} = Astro.props;

function getVariantClass(variant: string): string {
  switch (variant) {
    case 'read': return 'method-read';
    case 'write': return 'method-write';
    case 'special': return 'method-special';
    default: return 'method-default';
  }
}

function getStandardColor(standard: string): string {
  switch (standard) {
    case 'HTTP': return 'var(--sl-color-gray-3)';
    case 'WebDAV': return 'var(--sl-color-blue)';
    case 'CalDAV': return 'var(--sl-color-green)';
    case 'CardDAV': return 'var(--sl-color-purple)';
    default: return 'var(--sl-color-gray-3)';
  }
}
---

<div class={`method-card ${getVariantClass(variant)} ${!implemented ? 'method-unimplemented' : ''}`}>
  <div class="method-header">
    <div class="method-title-row">
      <h3 class="method-name">{method}</h3>
      <div class="method-meta-badges">
        {httpMethod && (
          <span class="http-method-badge">{httpMethod}</span>
        )}
        <span class="standard-badge" style={`background-color: ${getStandardColor(standard)};`}>
          {standard}
        </span>
        {!implemented && (
          <span class="status-badge status-unimplemented">Not Implemented</span>
        )}
        {since && (
          <span class="status-badge status-version">Since v{since}</span>
        )}
      </div>
    </div>
    {rfc && (
      <div class="rfc-reference">
        <a href={`https://datatracker.ietf.org/doc/html/rfc${rfc}`} target="_blank" rel="noopener noreferrer">
          RFC {rfc}
        </a>
      </div>
    )}
  </div>

  <div class="method-body">
    {Astro.slots.has('description') && (
      <div class="method-section">
        <slot name="description" />
      </div>
    )}

    <div class="method-details">
      {Astro.slots.has('request') && (
        <div class="detail-section">
          <h4 class="detail-title">Request</h4>
          <div class="detail-content">
            <slot name="request" />
          </div>
        </div>
      )}

      {Astro.slots.has('response') && (
        <div class="detail-section">
          <h4 class="detail-title">Response</h4>
          <div class="detail-content">
            <slot name="response" />
          </div>
        </div>
      )}
    </div>

    {Astro.slots.has('example') && (
      <div class="method-example">
        <h4 class="example-title">Example</h4>
        <slot name="example" />
      </div>
    )}

    {Astro.slots.has('notes') && (
      <div class="method-notes">
        <h4 class="notes-title">Implementation Notes</h4>
        <slot name="notes" />
      </div>
    )}
  </div>
</div>

<style>
  .method-card {
    margin: 1.5rem 0;
    border: 2px solid var(--sl-color-gray-5);
    border-radius: 0.5rem;
    background: var(--sl-color-bg);
    overflow: hidden;
    transition: border-color 0.2s ease, box-shadow 0.2s ease;
  }

  .method-card:hover {
    border-color: var(--sl-color-gray-4);
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
  }

  /* Variant styling */
  .method-read {
    border-left: 4px solid var(--sl-color-blue);
  }

  .method-write {
    border-left: 4px solid var(--sl-color-green);
  }

  .method-special {
    border-left: 4px solid var(--sl-color-purple);
  }

  .method-unimplemented {
    opacity: 0.7;
    border-style: dashed;
  }

  .method-header {
    padding: 1.25rem 1.5rem;
    background: var(--sl-color-gray-6);
    border-bottom: 1px solid var(--sl-color-gray-5);
  }

  .method-title-row {
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: 1rem;
    flex-wrap: wrap;
  }

  .method-name {
    margin: 0;
    font-size: var(--sl-text-xl);
    font-weight: 700;
    font-family: var(--sl-font-mono);
    color: var(--sl-color-white);
    letter-spacing: 0.025em;
  }

  .method-meta-badges {
    display: flex;
    gap: 0.5rem;
    flex-wrap: wrap;
  }

  .http-method-badge,
  .standard-badge {
    display: inline-block;
    padding: 0.25rem 0.625rem;
    border-radius: 0.25rem;
    font-size: var(--sl-text-xs);
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 0.05em;
  }

  .http-method-badge {
    background: var(--sl-color-gray-5);
    color: var(--sl-color-white);
  }

  .standard-badge {
    color: white;
  }

  .status-badge {
    display: inline-block;
    padding: 0.25rem 0.625rem;
    border-radius: 0.25rem;
    font-size: var(--sl-text-xs);
    font-weight: 600;
    text-transform: uppercase;
  }

  .status-unimplemented {
    background: var(--sl-color-orange-high);
    color: var(--sl-color-orange-low);
  }

  .status-version {
    background: var(--sl-color-blue-high);
    color: var(--sl-color-blue-low);
  }

  .rfc-reference {
    margin-top: 0.5rem;
    font-size: var(--sl-text-sm);
  }

  .rfc-reference a {
    color: var(--sl-color-text-accent);
    text-decoration: none;
    font-weight: 500;
    transition: color 0.2s ease;
  }

  .rfc-reference a:hover {
    color: var(--sl-color-accent);
    text-decoration: underline;
  }

  .method-body {
    padding: 1.5rem;
  }

  .method-section {
    margin-bottom: 1.5rem;
    color: var(--sl-color-gray-2);
    line-height: 1.7;
  }

  .method-section :global(p:first-child) {
    margin-top: 0;
  }

  .method-section :global(p:last-child) {
    margin-bottom: 0;
  }

  .method-details {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 1.5rem;
    margin-bottom: 1.5rem;
  }

  .detail-section {
    padding: 1rem;
    background: var(--sl-color-gray-6);
    border-radius: 0.375rem;
    border: 1px solid var(--sl-color-gray-5);
  }

  .detail-title {
    margin: 0 0 0.75rem 0;
    font-size: var(--sl-text-sm);
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.05em;
    color: var(--sl-color-gray-3);
  }

  .detail-content {
    font-size: var(--sl-text-sm);
    color: var(--sl-color-gray-2);
  }

  .detail-content :global(p) {
    margin: 0.5rem 0;
  }

  .detail-content :global(p:first-child) {
    margin-top: 0;
  }

  .detail-content :global(p:last-child) {
    margin-bottom: 0;
  }

  .detail-content :global(code) {
    font-family: var(--sl-font-mono);
    font-size: 0.9em;
    padding: 0.125rem 0.375rem;
    background: var(--sl-color-gray-5);
    border-radius: 0.25rem;
  }

  .detail-content :global(ul),
  .detail-content :global(ol) {
    margin: 0.5rem 0;
    padding-left: 1.25rem;
  }

  .method-example,
  .method-notes {
    margin-top: 1.5rem;
    padding-top: 1.5rem;
    border-top: 1px solid var(--sl-color-gray-5);
  }

  .example-title,
  .notes-title {
    font-size: var(--sl-text-sm);
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.05em;
    color: var(--sl-color-gray-3);
    margin-bottom: 0.75rem;
  }

  .method-example :global(pre) {
    margin-top: 0;
  }

  .method-notes :global(p:first-child) {
    margin-top: 0;
  }

  .method-notes :global(p:last-child) {
    margin-bottom: 0;
  }

  /* Mobile responsive */
  @media (max-width: 768px) {
    .method-header {
      padding: 1rem;
    }

    .method-body {
      padding: 1rem;
    }

    .method-title-row {
      flex-direction: column;
      align-items: flex-start;
      gap: 0.75rem;
    }

    .method-name {
      font-size: var(--sl-text-lg);
    }

    .method-details {
      grid-template-columns: 1fr;
      gap: 1rem;
    }
  }

  /* Dark mode adjustments */
  :root[data-theme='dark'] .method-header {
    background: var(--sl-color-gray-5);
  }

  :root[data-theme='dark'] .detail-section {
    background: var(--sl-color-gray-5);
  }

  :root[data-theme='dark'] .method-card:hover {
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
  }
</style>
