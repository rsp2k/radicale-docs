---
title: Configure htpasswd Authentication
description: Secure your server with file-based password authentication
diataxis_type: how-to
sidebar:
  order: 1
---

import { Tabs, TabItem, Aside } from '@astrojs/starlight/components';

## Problem

You need to restrict access to your Radicale server using usernames and passwords stored in a file, avoiding the complexity of LDAP or database authentication.

## Prerequisites

- Working Radicale installation
- Write access to Radicale configuration directory
- Either `htpasswd` utility (from Apache) or Python's `bcrypt` library

## Solution

### Basic Configuration

1. Edit your Radicale configuration file:

   ```bash
   nano /etc/radicale/config
   ```

2. Set the authentication type and password file location:

   ```ini
   [auth]
   type = htpasswd
   htpasswd_filename = /etc/radicale/users
   htpasswd_encryption = bcrypt
   ```

3. Set appropriate file permissions:

   ```bash
   touch /etc/radicale/users
   chmod 640 /etc/radicale/users
   chown radicale:radicale /etc/radicale/users
   ```

<Aside type="tip">
Use `bcrypt` encryption for production. It's the most secure option and resistant to brute-force attacks.
</Aside>

### Creating the Password File

<Tabs>
  <TabItem label="htpasswd (recommended)">
    Install htpasswd if not available:

    ```bash
    # Debian/Ubuntu
    sudo apt install apache2-utils

    # RHEL/Fedora
    sudo dnf install httpd-tools

    # macOS
    brew install httpd
    ```

    Create the first user:

    ```bash
    htpasswd -c -B /etc/radicale/users alice
    ```

    Add additional users (omit `-c` flag):

    ```bash
    htpasswd -B /etc/radicale/users bob
    htpasswd -B /etc/radicale/users charlie
    ```

    <Aside type="caution">
    The `-c` flag overwrites the file. Only use it for the first user.
    </Aside>
  </TabItem>

  <TabItem label="Python bcrypt">
    Install the bcrypt library:

    ```bash
    pip3 install bcrypt
    ```

    Create a password hash:

    ```python
    import bcrypt
    import getpass

    username = input("Username: ")
    password = getpass.getpass("Password: ").encode('utf-8')
    hashed = bcrypt.hashpw(password, bcrypt.gensalt())

    with open('/etc/radicale/users', 'a') as f:
        f.write(f"{username}:{hashed.decode('utf-8')}\n")
    ```

    Run this script for each user you want to add.
  </TabItem>

  <TabItem label="Plain text (testing only)">
    <Aside type="danger">
    Plain text passwords are insecure. Only use for local testing.
    </Aside>

    Configuration:

    ```ini
    [auth]
    type = htpasswd
    htpasswd_filename = /etc/radicale/users
    htpasswd_encryption = plain
    ```

    Create users:

    ```bash
    echo "alice:password123" > /etc/radicale/users
    echo "bob:password456" >> /etc/radicale/users
    ```
  </TabItem>
</Tabs>

### Verification

Test authentication:

```bash
# Should succeed
curl -u alice:correct_password http://localhost:5232/alice/

# Should fail with 401 Unauthorized
curl -u alice:wrong_password http://localhost:5232/alice/
```

Check Radicale logs for authentication attempts:

```bash
tail -f /var/log/radicale/radicale.log
```

You'll see successful logins and authentication failures.

## Variations

### Using SHA-512 Instead of bcrypt

If bcrypt is unavailable or causes compatibility issues:

```ini
[auth]
htpasswd_encryption = sha512
```

Generate passwords:

```bash
htpasswd -B -s /etc/radicale/users username
```

<Aside type="note">
SHA-512 is less secure than bcrypt but still acceptable for moderate security needs.
</Aside>

### Storing Password File Outside Configuration Directory

Place the password file anywhere accessible:

```ini
[auth]
htpasswd_filename = /var/lib/radicale/users
```

Ensure Radicale process has read access:

```bash
chmod 440 /var/lib/radicale/users
chown root:radicale /var/lib/radicale/users
```

### Rate Limiting Failed Attempts

Configure delay after failed authentication:

```ini
[auth]
type = htpasswd
htpasswd_filename = /etc/radicale/users
htpasswd_encryption = bcrypt
delay = 3
```

This adds a 3-second delay after each failed login, slowing brute-force attacks.

## Handling Edge Cases

### SELinux Contexts

If you're using SELinux, set the correct context on the password file:

```bash
semanage fcontext -a -t radicale_var_lib_t "/etc/radicale/users"
restorecon -v /etc/radicale/users
```

Verify:

```bash
ls -Z /etc/radicale/users
```

### Password Files on Network Mounts

If your password file is on NFS or CIFS:

1. Ensure mount options include `noacl` or proper ACL support
2. Test file access as the Radicale user:

   ```bash
   sudo -u radicale cat /etc/radicale/users
   ```

3. Consider copying to local storage for better performance:

   ```bash
   # Sync password file every 5 minutes
   */5 * * * * cp /mnt/network/users /etc/radicale/users
   ```

### Multiple Password Files

Radicale only supports one password file. If you need multiple sources:

1. Merge files manually:

   ```bash
   cat /path/to/users1 /path/to/users2 > /etc/radicale/users
   ```

2. Or use LDAP authentication which supports multiple backends:

   See [LDAP authentication guide](/how-to/auth/ldap/)

### Changing Passwords

Update a user's password:

```bash
htpasswd -B /etc/radicale/users alice
```

Radicale reads the file on each authentication attempt, so changes take effect immediately without restart.

### Removing Users

Delete a line from the password file:

```bash
# Remove user 'bob'
sed -i '/^bob:/d' /etc/radicale/users
```

Or edit manually with a text editor.

## Troubleshooting

### Authentication Always Fails

Check file permissions:

```bash
sudo -u radicale cat /etc/radicale/users
```

If this fails, fix ownership:

```bash
chown radicale:radicale /etc/radicale/users
```

### bcrypt Import Errors

If you see "No module named '_bcrypt'":

1. Install system dependencies:

   ```bash
   # Debian/Ubuntu
   sudo apt install python3-dev libffi-dev

   # RHEL/Fedora
   sudo dnf install python3-devel libffi-devel
   ```

2. Reinstall bcrypt:

   ```bash
   pip3 uninstall bcrypt
   pip3 install bcrypt
   ```

### Performance Issues with Large Password Files

Radicale reads the entire file for each authentication. With 1000+ users, consider:

1. Using LDAP instead: [LDAP guide](/how-to/auth/ldap/)
2. Implementing caching via a reverse proxy
3. Using PAM authentication: [PAM guide](/how-to/auth/pam/)

## Related Tasks

- [Set up LDAP authentication](/how-to/auth/ldap/) for enterprise user management
- [Configure OAuth2](/how-to/auth/oauth2/) for third-party authentication
- [Restrict access with rights management](/how-to/rights/owner-only/) beyond authentication
- [Troubleshoot authentication issues](/how-to/troubleshooting/auth/) when things go wrong
