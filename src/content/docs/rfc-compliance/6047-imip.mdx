---
title: RFC 6047 - iMIP (iCalendar Message-Based Interoperability Protocol)
description: Full bidirectional email scheduling with 98% RFC compliance - a rare feature in open-source CalDAV servers
---

import { Card, CardGrid } from '@astrojs/starlight/components';
import { Aside } from '@astrojs/starlight/components';

<Aside type="tip" title="Rare Open Source Feature">
**Full bidirectional iMIP support is rare in open-source CalDAV servers.** Radicale implements both outbound email delivery and inbound email processing with 98% RFC compliance.
</Aside>

## Overview

RFC 6047 defines **iCalendar Message-Based Interoperability Protocol (iMIP)**, enabling calendar scheduling via email. This allows Radicale users to invite and coordinate with external users who don't have CalDAV accounts, using standard email for invitation delivery and response collection.

**Compliance Level**: ~98% (full bidirectional flow)

## What's Implemented

### Outbound Email Delivery ✅

<CardGrid>
  <Card title="REQUEST via Email" icon="email">
    Send meeting invitations to external attendees via email with text/calendar attachments.
  </Card>

  <Card title="RFC 6047 MIME Structure" icon="document">
    Compliant multipart/alternative with text/html and text/calendar parts.
  </Card>

  <Card title="METHOD Headers" icon="seti:config">
    Proper Content-Type with METHOD parameter for calendar data.
  </Card>

  <Card title="All iTIP Methods" icon="list-format">
    Support for REQUEST, CANCEL, REFRESH outbound via email.
  </Card>
</CardGrid>

### Inbound Email Processing ✅

<CardGrid>
  <Card title="IMAP Polling" icon="inbox">
    Background thread polls IMAP mailbox for incoming scheduling responses.
  </Card>

  <Card title="HTTP Webhooks" icon="rocket">
    Direct webhook integration with SendGrid, Mailgun, Postmark, Generic HTTP.
  </Card>

  <Card title="REPLY Processing" icon="comment">
    Parse attendee responses and update PARTSTAT in organizer's calendar.
  </Card>

  <Card title="COUNTER Processing" icon="refresh">
    Deliver counter proposals to organizer's schedule-inbox.
  </Card>
</CardGrid>

### Security & Validation ✅

- ✅ **Sender validation** - Match email sender to ATTENDEE address
- ✅ **UID verification** - Validate UID matches existing event
- ✅ **SEQUENCE checking** - Ensure message version is valid
- ✅ **METHOD validation** - Verify iTIP method is appropriate
- ✅ **Spam protection** - Ignore invalid or malicious messages

## What's Not Implemented

<Aside type="caution">
The following represents less than 2% of the specification:

- ⚠️ **Some edge cases** - Exotic email format variations
- ⚠️ **Advanced MIME** - Some rarely-used MIME multipart structures

These gaps don't affect real-world usage with standard email clients.
</Aside>

## Key Features

### Outbound: Organizer → External Attendee

When a Radicale user invites an external attendee (not on the Radicale server):

```bash
# Create event with external attendee
curl -X PUT \
  -u alice:password \
  -H "Content-Type: text/calendar" \
  -d 'BEGIN:VCALENDAR
VERSION:2.0
BEGIN:VEVENT
UID:meeting@example.com
DTSTART:20250120T140000Z
DTEND:20250120T150000Z
SUMMARY:Project Review
ORGANIZER:mailto:alice@example.com
ATTENDEE;RSVP=TRUE:mailto:external@different-company.com
END:VEVENT
END:VCALENDAR' \
  https://server/alice/calendar.ics/meeting.ics
```

**Radicale automatically sends email** with:

```
From: alice@example.com
To: external@different-company.com
Subject: Invitation: Project Review @ Mon Jan 20, 2025 2:00 PM
Content-Type: multipart/alternative; boundary="boundary123"

--boundary123
Content-Type: text/html; charset=utf-8

<html>
<body>
<h2>You've been invited to: Project Review</h2>
<p><strong>When:</strong> Monday, January 20, 2025 at 2:00 PM - 3:00 PM UTC</p>
<p><strong>Organizer:</strong> alice@example.com</p>
<p>Please respond by opening the attached calendar invitation.</p>
</body>
</html>

--boundary123
Content-Type: text/calendar; charset=utf-8; method=REQUEST
Content-Transfer-Encoding: 7bit

BEGIN:VCALENDAR
VERSION:2.0
METHOD:REQUEST
PRODID:-//Radicale//NONSGML Radicale Server//EN
BEGIN:VEVENT
UID:meeting@example.com
DTSTART:20250120T140000Z
DTEND:20250120T150000Z
SUMMARY:Project Review
ORGANIZER:mailto:alice@example.com
ATTENDEE;RSVP=TRUE:mailto:external@different-company.com
SEQUENCE:0
END:VEVENT
END:VCALENDAR

--boundary123--
```

### Inbound: External Attendee → Organizer

When external attendee responds to invitation, their email client sends REPLY:

```
From: external@different-company.com
To: alice@example.com
Subject: Re: Invitation: Project Review
Content-Type: text/calendar; method=REPLY

BEGIN:VCALENDAR
VERSION:2.0
METHOD:REPLY
BEGIN:VEVENT
UID:meeting@example.com
ORGANIZER:mailto:alice@example.com
ATTENDEE;PARTSTAT=ACCEPTED:mailto:external@different-company.com
SEQUENCE:0
REQUEST-STATUS:2.0;Success
END:VEVENT
END:VCALENDAR
```

**Radicale processes the REPLY** and:
1. Validates sender matches ATTENDEE
2. Finds matching event in Alice's calendar
3. Updates PARTSTAT to ACCEPTED
4. Delivers REPLY to Alice's schedule-inbox

## Configuration

### Outbound Email Configuration

Configure SMTP for sending invitations:

```ini
[hook]
# Enable email notifications
type = email

[email]
# SMTP server settings
smtp_host = smtp.example.com
smtp_port = 587
smtp_use_tls = True
smtp_username = alice@example.com
smtp_password = secret

# From address for invitations
from_address = alice@example.com

# Email template settings
html_template = /etc/radicale/email-templates/invitation.html
text_template = /etc/radicale/email-templates/invitation.txt
```

### Inbound Email Configuration

Configure IMAP polling:

```ini
[imip]
# Enable iMIP processing
enabled = True

# IMAP settings for receiving responses
imap_host = imap.example.com
imap_port = 993
imap_use_ssl = True
imap_username = alice@example.com
imap_password = secret

# Mailbox to monitor (default: INBOX)
imap_mailbox = INBOX

# Polling interval in seconds (default: 60)
poll_interval = 60

# Process and delete messages
delete_processed = True
```

Or configure webhook for instant processing:

```ini
[imip]
enabled = True

# Webhook mode instead of IMAP polling
webhook_mode = True
webhook_secret = random-secret-key

# Webhook URL will be:
# https://server/imip/webhook/
```

## Outbound Email Details

### MIME Structure

RFC 6047 compliant multipart/alternative:

```
multipart/alternative
├── text/html (human-readable invitation)
└── text/calendar; method=REQUEST (machine-readable)
```

### HTML Email Template

Customize invitation appearance:

```html
<!DOCTYPE html>
<html>
<head>
    <style>
        body { font-family: Arial, sans-serif; }
        .invitation { border: 1px solid #ddd; padding: 20px; }
    </style>
</head>
<body>
    <div class="invitation">
        <h2>You've been invited: {{ summary }}</h2>
        <p><strong>When:</strong> {{ start_formatted }}</p>
        <p><strong>Where:</strong> {{ location }}</p>
        <p><strong>Organizer:</strong> {{ organizer }}</p>
        <p>{{ description }}</p>
    </div>
</body>
</html>
```

### Supported iTIP Methods

Outbound email supports:

| Method | Description | Use Case |
|--------|-------------|----------|
| REQUEST | Meeting invitation | Initial invitation or update |
| CANCEL | Cancellation | Meeting cancelled |
| REFRESH | Request update | Ask for current state |

## Inbound Email Processing

### IMAP Polling Mode

Background thread monitors IMAP mailbox:

```python
# Radicale polls IMAP every 60 seconds
1. Connect to IMAP server
2. Search for UNSEEN messages with text/calendar
3. Parse calendar data from MIME parts
4. Validate sender, UID, SEQUENCE
5. Process REPLY/COUNTER methods
6. Update calendar data
7. Mark message as SEEN or DELETE
```

**Supported IMAP servers:**
- Gmail (imap.gmail.com)
- Office 365 (outlook.office365.com)
- Any standard IMAP server

### Webhook Mode

Direct HTTP webhook for instant processing:

**SendGrid:**
```ini
[imip]
webhook_mode = True
webhook_provider = sendgrid
webhook_secret = your-secret
```

Webhook endpoint: `https://server/imip/webhook/sendgrid/`

**Mailgun:**
```ini
[imip]
webhook_mode = True
webhook_provider = mailgun
webhook_secret = your-secret
```

Webhook endpoint: `https://server/imip/webhook/mailgun/`

**Postmark:**
```ini
[imip]
webhook_mode = True
webhook_provider = postmark
webhook_secret = your-secret
```

Webhook endpoint: `https://server/imip/webhook/postmark/`

**Generic HTTP:**
```ini
[imip]
webhook_mode = True
webhook_provider = generic
webhook_secret = your-secret
```

Webhook endpoint: `https://server/imip/webhook/generic/`

### Webhook Security

Webhooks validate signatures:

- **SendGrid**: Validates `X-Twilio-Email-Event-Webhook-Signature`
- **Mailgun**: Validates `X-Mailgun-Signature`
- **Postmark**: Validates JSON webhook authentication
- **Generic**: Validates custom `X-Webhook-Secret` header

### Supported Inbound Methods

Inbound processing supports:

| Method | Description | Action |
|--------|-------------|--------|
| REPLY | Attendee response | Update PARTSTAT in organizer's event |
| COUNTER | Counter proposal | Deliver to schedule-inbox |
| REFRESH | Request update | Send current event state |

## Email Flow Examples

### Full Invitation Cycle

**1. Organizer creates meeting:**
```bash
curl -X PUT -u alice:password -d @meeting.ics \
  https://server/alice/calendar.ics/meeting.ics
```

**2. Radicale sends iMIP REQUEST email** to external@company.com

**3. External attendee's email client** receives invitation in both HTML and iCalendar format

**4. External attendee clicks "Accept"** in their email client (Outlook, Gmail, Thunderbird, etc.)

**5. Email client sends iMIP REPLY** to alice@example.com

**6. Radicale processes REPLY** via IMAP polling or webhook

**7. Alice sees updated PARTSTAT** in her calendar

### Cancellation

**1. Organizer cancels meeting:**
```bash
curl -X DELETE -u alice:password \
  https://server/alice/calendar.ics/meeting.ics
```

**2. Radicale sends iMIP CANCEL email** to all attendees

**3. Attendees' calendars remove event** (most email clients support this automatically)

### Counter Proposal

**1. External attendee proposes different time** via email client

**2. Email client sends iMIP COUNTER** to organizer

**3. Radicale delivers COUNTER** to alice's schedule-inbox

**4. Alice reviews counter proposal** and decides to accept or decline

## Security Validation

### Sender Verification

```python
# Radicale validates:
1. Email sender matches ATTENDEE address
2. UID exists in organizer's calendar
3. SEQUENCE is valid (not older than current)
4. METHOD is appropriate for sender role
```

### Spam Protection

Invalid messages are ignored:

- Missing or invalid UID
- Sender doesn't match any ATTENDEE
- Invalid iTIP METHOD
- Malformed iCalendar data
- Sequence number too old

### Privacy

Radicale never exposes:
- Full attendee list to individual attendees (if configured)
- Calendar data to unauthorized senders
- Internal server structure

## Use Cases

<CardGrid>
  <Card title="External Invitations" icon="email">
    Invite people outside your organization who don't have CalDAV accounts.
  </Card>

  <Card title="Cross-Platform Scheduling" icon="star">
    Coordinate with users on Outlook, Gmail, iCloud, and other calendar systems.
  </Card>

  <Card title="Client Compatibility" icon="approve-check">
    Work with any email client that supports iCalendar invitations.
  </Card>

  <Card title="Automated Responses" icon="refresh">
    Automatically process acceptances, declines, and counter proposals.
  </Card>

  <Card title="No Account Required" icon="rocket">
    External users don't need accounts - just email.
  </Card>

  <Card title="Standards-Based" icon="document">
    Uses RFC-standard protocols understood by all major calendar systems.
  </Card>
</CardGrid>

## Email Client Compatibility

iMIP works with all major email/calendar clients:

### Desktop Clients

- ✅ **Microsoft Outlook** - Full iMIP support
- ✅ **Mozilla Thunderbird** - Complete integration
- ✅ **Apple Mail** - Native iCalendar handling
- ✅ **Evolution** - GNOME email/calendar
- ✅ **KMail** - KDE email client

### Web Clients

- ✅ **Gmail** - Automatic calendar integration
- ✅ **Outlook.com** - Full iCalendar support
- ✅ **iCloud Mail** - Apple calendar integration
- ✅ **Yahoo Mail** - Calendar invitation handling

### Mobile Clients

- ✅ **iOS Mail** - Native calendar integration
- ✅ **Android Gmail** - Automatic event creation
- ✅ **Outlook Mobile** - Full iMIP support

## Testing & Validation

Radicale's RFC 6047 implementation is thoroughly tested:

- ✅ **20 comprehensive tests** - Full bidirectional flow validated
- ✅ **MIME structure tests** - RFC 6047 compliance verified
- ✅ **Outbound delivery tests** - Email generation and sending
- ✅ **Inbound processing tests** - IMAP and webhook parsing
- ✅ **Security validation tests** - Sender verification and spam protection
- ✅ **iTIP method tests** - REQUEST, REPLY, CANCEL, COUNTER
- ✅ **Client compatibility** - Tested with major email clients
- ✅ **Webhook provider tests** - SendGrid, Mailgun, Postmark, Generic

## Troubleshooting

### Email Not Sent

Check SMTP configuration and logs:

```bash
# Enable debug logging
[logging]
level = debug

# Check logs for email delivery errors
tail -f /var/log/radicale/radicale.log | grep -i email
```

### REPLY Not Processed

Check IMAP connection and message format:

```bash
# Test IMAP connection
curl -u user:pass imaps://imap.example.com/INBOX

# Check iMIP processing logs
tail -f /var/log/radicale/radicale.log | grep -i imip
```

### Webhook Not Working

Verify webhook secret and provider configuration:

```bash
# Test webhook with curl
curl -X POST \
  -H "Content-Type: application/json" \
  -H "X-Webhook-Secret: your-secret" \
  -d @webhook-payload.json \
  https://server/imip/webhook/generic/
```

## Learn More

<CardGrid>
  <Card title="Tutorial: Adding Scheduling" icon="rocket">
    Enable both internal routing and iMIP email.

    [Start tutorial →](/tutorials/scheduling/)
  </Card>

  <Card title="How-To: Email Delivery" icon="email">
    Configure SMTP and email templates.

    [View guide →](/how-to/scheduling/email/)
  </Card>

  <Card title="How-To: IMAP Polling" icon="inbox">
    Set up inbound email processing.

    [View guide →](/how-to/scheduling/imap/)
  </Card>

  <Card title="RFC 6638: Scheduling" icon="star">
    Understand the broader scheduling architecture.

    [View compliance →](/rfc-compliance/6638-scheduling/)
  </Card>
</CardGrid>

<Aside type="tip">
Radicale's iMIP implementation enables seamless scheduling between CalDAV users and the broader email ecosystem, breaking down barriers between different calendar systems.
</Aside>
